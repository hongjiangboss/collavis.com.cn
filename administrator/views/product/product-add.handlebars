<div class="container-fluid">
        {{> 'titlebar'}}
        <ul class="nav nav-tabs" style="margin-top: 2em" id="h-nav">
                <li class="active" role="presentation">
                        <a href="#home" aria-controls="home" role="tab" data-toggle="tab">基本信息</a>
                </li>
                <li role="presentation">
                        <a href="#picture" aria-controls="picture" role="tab" data-toggle="tab">产品图片</a>
                </li>
                <li role="presentation">
                        <a href="#info" aria-controls="info" role="tab" data-toggle="tab">详细信息</a>
                </li>
        </ul>
        <form class="form-horizontal" method="post" action="/product/adddo.html?{{querystr}}" id="h-form">
        <div class="row tab-content" style="margin-top:1em">
                <div role="tabpanel" class="tab-pane active" id="home">
                        <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6">
                                <div class="form-group" style="display:none">
                                        <label class="col-sm-2 control-label h-form-label">编号</label>
                                        <div class="col-sm-10">
                                                <input type="text" class="form-control h-setting-field" name="{{key}}" value="{{value}}"/>
                                        </div>
                                </div>
                                <div class="form-group">
                                        <label class="col-sm-2 control-label h-form-label" id="h-label-title">标题</label>
                                        <div class="col-sm-10">
                                                <input type="text" class="form-control h-setting-field" id="h-title" value="{{value}}"/>
                                        </div>
                                </div>
                                <div class="form-group">
                                        <label class="col-sm-2 control-label h-form-label">分类</label>
                                        <div class="col-sm-10">
                                                <select name="partID" id="h-category">
                                                        {{#each category}}
                                                        <option value="{{value}}" {{selected}}>{{name}}</option>
                                                        {{/each}}
                                                </select>
                                        </div>
                                </div>
                                <div class="form-group">
                                        <label class="col-sm-2 control-label h-form-label">系列</label>
                                        <div class="col-sm-10">
                                                <select name="partID" id="h-xilie">
                                                        <option value="" {{selected}}>未选择</option>
                                                        {{#each xilie}}
                                                        <option value="{{value}}" {{selected}}>{{name}}</option>
                                                        {{/each}}
                                                </select>
                                        </div>
                                </div>
                                <div class="form-group">
                                        <label class="col-sm-2 control-label h-form-label">容量</label>
                                        <div class="col-sm-10">
                                                <input type="text" class="form-control h-setting-field" id="h-size" value="{{value}}"/>
                                        </div>
                                </div>
                                <div class="form-group">
                                        <label class="col-sm-2 control-label h-form-label">价格</label>
                                        <div class="col-sm-10">
                                                <input type="text" class="form-control h-setting-field" id="h-price" value="{{value}}"/>
                                        </div>
                                </div>
                                <div class="form-group">
                                        <label class="col-sm-2 control-label h-form-label">链接</label>
                                        <div class="col-sm-10">
                                                <input type="text" class="form-control h-setting-field" id="h-shop" value="{{value}}"/>
                                        </div>
                                </div>
                        </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="picture">
                        <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6">
                                {{#each picture}}
                                <div class="form-group">
                                        <label class="col-sm-2 control-label h-form-label">{{{name}}}</label>
                                        <div class="col-sm-10">
                                                <input type="file" name="image" onclick="upload(this, '{{key}}')" class="form-control" />
                                                <input type="text" class="form-control h-setting-field h-field-input" name="{{key}}"
                                                value="{{value}}" id="h-upload-{{key}}" style="margin-top: 0.5em" />
                                        </div>
                                </div>
                                {{/each}}
                        </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="info">
                        <div class="col-xs-12 col-md-12">
                                <div class="form-group">
                                        <label class="col-sm-1 control-label h-form-label">摘要</label>
                                        <div class="col-sm-11">
                                                <input type="text" class="form-control" name="description" id="h-description" />
                                        </div>
                                </div>
                                <div class="form-group">
                                        <label class="col-sm-1 control-label h-form-label">内容</label>
                                        <div class="col-sm-11" id="h-textarea">
                                                <textarea class="form-control" style="height:20em" id="h-content"></textarea>
                                        </div>
                                </div>
                        </div>
                </div>
        </div>
        <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-6 col-lg-6">
                        <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-10 h-message" id="h-message"></div>
                        </div>
                        <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-10">
                                        <button type="button" class="btn btn-primary" id="h-submit" onclick="hedit()">发布</button>
                                </div>
                        </div>
                </div>
        </div>
        <div class="row">
                <div class="col-xs-12 col-md-12">
                        <div class="col-sm-11" id="h-stable-width"></div>
                </div>
        </div>
        </form>
</div>
</div>
<link rel="stylesheet" href="{{resource client 'dist/umeditor1_2_2/themes/default/css/umeditor.css'}}" />
<script type="text/javascript" src="{{resource client 'dist/umeditor1_2_2/umeditor.config.js'}}"></script>
<script type="text/javascript" src="{{resource client 'dist/umeditor1_2_2/umeditor.min.js'}}"></script>
<script type="text/javascript" src="{{resource client 'dist/umeditor1_2_2/lang/zh-cn/zh-cn.js'}}"></script>
<script type="text/javascript" src="{{resource client 'dist/jquery.ajaxfileupload.js'}}"></script>
<script type="text/javascript">
function upload (o, key) {
        jQuery(o).ajaxfileupload({
                action: '/service/upload.html?{{querystr}}',
                onComplete: function (response) {
                        jQuery('#h-upload-' + key).val(response['href']);
                }
        })
}
function hedit () {
        var params = {
                'title': jQuery('#h-title').val(),
                'description': jQuery('#h-description').val(),
                'datetime': jQuery('#h-date').val(),
                'content': UM.getEditor('h-content').getContent(),
                'visited': jQuery('#h-visited').val(),
                'category': jQuery('#h-category').val(),
                'xilie': jQuery('#h-xilie').val(),
                'size': jQuery('#h-size').val(),
                'price': jQuery('#h-price').val(),
                'shop': jQuery('#h-shop').val()
                //'image': jQuery('#h-upload-image').val()
        }
        var buffers = []
        jQuery('.h-field-input').each(function () {
                console.log(this);
                buffers.push(jQuery(this).val());
        })
        params.image = JSON.stringify(buffers);

        if (!params['title']) {
                return jQuery('#h-message').html('产品标题不能为空');
        }

        jQuery.post('/product/adddo.html?{{{querystr}}}', params, function(result){
                if (result['code'] === '0') {
                        alert('添加产品成功');
                        window.location.href = '/product/product.html?{{{querystr}}}';
                        return
                }
                jQuery('#h-message').html(result['message']);
        })
}
jQuery('#h-content').css('width', jQuery('#h-stable-width').width() + 54);
UM.getEditor('h-content', {
        imageUrl: '{{{image_upload}}}?{{{querystr}}}',
        imagePath: '{{{image_path}}}/public/upload/'
});
window.onresize = function () {
        jQuery('.edui-container').css('width', jQuery('#h-stable-width').width() + 28);
        jQuery('.edui-body-container').css('width', jQuery('#h-stable-width').width() + 28);
}
</script>
